// Uses
@use "sass:meta";
@use "sass:list";
@use "sass:string";
// @use "_CreateLogMessage.func.scss" as CLM;

// TODO: Add equals to option
// TODO: Add checks to make sure
// ! Does not handle nested list/maps very well at the momment :/. 
// ! I guess there is no way to know how big a list will be and how deep,,, this could lead to checks taking vary long.
/// CheckVariable Constraints - Checks if a variable meets the following constraints.
/// Though, $type, $min, and $max arguments are optional, if none are passed an error will be thrown.
/// @author Jordan Vezina(staticBanter)
/// 
/// @access public
/// @group functions.helper
/// @since v0.2.0 - Development
/// @require {function} CreateLogMessage <./dist/scss/functions/_CreateLogMessage.func.scss>
/// @param {any} $check - The variable to check.
/// @param {string} $againstType [null] - The type the variable should be.
/// @param {number} $min [null] - The min length/value of the variable.
/// @param {number} $max [null] - The max length/value of the variable.
/// @param {bool} $fullList [null] - If true and the $check is type list. Every item in the list must NOT be falsy.
/// @throws - TODO : INSERT ERROR CODES.
/// @returns {boolean} - Returns true If the variable passes the checks, returns false if variable fails or
/// was none existent.
@function CheckVariableConstraints($check,$againstType:null,$min:null,$max:null,$debug:null,$fullList:null){

    // Initialize the valid list to empty.
    $validList:();
    $checkType: meta.type-of($check);
 
    // List of allowed scss types.
    $allowedTypes:(
        "string",
        "number",
        // "color",
        "list",
        "map",
        "bool",
        "null",
        // "function",
        // "arglist"
    );
    
    @if($debug){
        
        // ? This should work but throws `Error: () isn't a valid CSS value.`
        // For now just going to debug the valid list.
        // FIX : No debug message
        @debug($validList);
        // @debug('| CheckVariableConstraint_Debug | | validList:' + $validList + '| | checkType : ' + $checkType + '|' );
    }

    // If not $check;
    // return false.
    // @if not $check{

    //     @if($debug){
    //         @debug("| CheckVariableConstraint_Debug | | Check was not set, returning false |" );
    //     }
        
    //     @return false;
    // }

    // If not; $type, or $min, or $max;
    // throw error. 
    @if not $againstType and not $min and not $max and not $fullList{
        @error(CreateLogMessage($code:("RMA","S"),$messageList:$errorMap,$messageOps:(("CheckVariableConstraints"),null)));
        // @error("~E:CVC-MA-1~ A constraint must be past.");
    }

    // If the check type was set.
    @if($againstType){

        @if($debug){
            @debug("| CheckVariableConstraint_Debug | | againstType : #{$againstType}| | checkType : #{$checkType} |" );
        }
        // If $againstType not string;
        // throw error.
        @if meta.type-of($againstType) != string{
            // @debug(meta.type-of($againstType));
            @error(CreateLogMessage($code:("IVA","IvT"),$messageList:$errorMap,$messageOps:("againstType","CheckVariableConstraints","string",meta.type-of($againstType))));
            // @error("~E:CVC-IVA-IT-1~ `againstType` must be a string");
        }

        // If $againstType not in $allowedTypes
        // throw error.
        @if not list.index($allowedTypes,$againstType){
            @error(CreateLogMessage($code:("IVA","IvT"),$messageList:$errorMap,$messageOps:("againstType","CheckVariableConstraints","string",meta.type-of($againstType))));
            // @error("~E:CVC-IVA-IT-1~ `checkType` must be of a valid type #{$allowedTypes}");
        }

        // If the $checkType is not equal to $againstType;
        // add false to $validList.
        @if $checkType != $againstType{

            $validList: list.append($validList,false);

            @if($debug){
                @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass againstType: #{$againstType}! | | validList : #{validList} |" );
            }
            
        }@else{

            $validList: list.append($validList,true);

            @if($debug){
                @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED againstType: #{$againstType}! | | validList : #{validList} |" );
            }

        }

    }  

    // If both $min and $max are set.
    @if $min and $max{

        // If both $max is less the $min throw error.
        // Thats just logic.
        @if($max < $min){
            @error(CreateLogMessage($code:("LE","LT"),$messageList:$errorMap,$messageOps:(("max","CheckVariableConstraint","min"),null)));
            // @error("~E:CVC-LE-1~ Max can not be less then min.");
        }

    }


    // If $min was set
    @if $min{

        @if($debug){
            @debug("| CheckVariableConstraint_Debug | | Checking min: #{$min}, of check: #{check} | | validList : #{validList} |" );
        }

        // If $min is not type-of number;
        // throw error.
        @if meta.type-of($min) != "number"{
            //@debug($min);
            @error(CreateLogMessage($code:("IvA","IvT"),$messageList:$errorMap,$messageOps:(("min","CheckVariableConstraints","number",meta.type-of($min)),null)));
            // @error("~E:CVC-IVA-IT-2~ `min` must be a number");
        }

        // If $check was a string, check if  string length is greater then;
        // Else check if $checks value is greater then min value.
        //NUMBER
        @if($checkType == number){

            @if($check < $min){

                $validList: list.append($validList,false);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass min: #{$min}. Min type `number`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            } @else{

                $validList: list.append($validList,true);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED min: #{$min}. Min type `number`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            }

        //STRING
        } @else if $checkType == string{

            @if(string.length($check) < $min){

                $validList: list.append($validList,false);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass min: #{$min}. Min type `string`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            } @else{

                $validList: list.append($validList,true);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED min: #{$min}. Min type `string`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            }

        //LIST or MAP
        }@else if $checkType == "list" or $checkType == "map"{

            @if(list.length($check) < $min){

                $validList: list.append($validList,false);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass min: #{$min}. Min type `string`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            } @else{

                $validList: list.append($validList,true);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED min: #{$min}. Min type `string`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            }

        }

    }


    // If $max was set
    @if $max{

        @if($debug){
            @debug("| CheckVariableConstraint_Debug | | Checking max: #{$max}, of check: #{check} | | validList : #{validList} |" );
        }

        // If $max is not type-of number;
        // throw error.
        @if meta.type-of($max) != number{
            @error(CreateLogMessage($code:("IvA","IvT"),$messageList:$errorMap,$messageOps:(("max","CheckVariableConstraints","number",meta.type-of($max)),null)));
            // @error("~E:CVC-IVA-IT-3~ `max` must be a number");
        }

        // If $check was a string, check if  string length is greater then;
        // Else check if $checks value is greater then max value.
        //NUMBER
        @if($checkType == number){

            @if($check > $max){

                $validList: list.append($validList,false);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass max: #{$max}. Max type `number`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            } @else{

                $validList: list.append($validList,true);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED max: #{$max}. max type `number`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            }

        //STRING
        } @else if $checkType == string{

            @if(string.length($check) > $max){

                $validList: list.append($validList,false);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass max: #{$max}. Max type `string`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            } @else{

                $validList: list.append($validList,true);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED max: #{$max}. Max type `string`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            }

        //LIST or MAP
        }@else if $checkType == "list" or $checkType == "map"{

            @if(list.length($check) > $max){

                $validList: list.append($validList,false);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass max: #{$max}. Max type `string`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            } @else{

                $validList: list.append($validList,true);

                @if($debug){
                    @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED max: #{$max}. Max type `string`, checkType: #{checkType}! | | validList : #{validList} |" );
                }

            }

        }

    }

    // If $fullList is set and the $checkType is list or map
    @if($fullList and ($checkType == "list" or $checkType == "map")){

        @if($debug){
            @debug("| CheckVariableConstraint_Debug | | $fullList set for $checkType, #{$checkType} | | Checking, #{$check} | | validList : #{validList} |" );
        }

        $tempList:();

        // Foreach item in the check.
        // If an item is falsy.
        // We will store all of these into a temp list.
        @each $item in $check{
            @if not ($item){
                $tempList:list.append($tempList,false);
            }

        } 

        @if($debug){
            @debug("| CheckVariableConstraint_Debug | | $fullList set for $checkType, #{$checkType} | | Checking, #{$check} | | Finished iterating through list current tempList is: |" );
            @debug("TEMPLIST:",$tempList);
        }

        // If the temp list contains false,
        // Add false to the $validList;
        // Else if the temp list is empty,
        // Or if the temp list does not contain false,
        // add true to the valid list.
        @if(list.index($tempList,false)){

            $validList: list.append($validList,false);

            @if($debug){
                @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass fullList. | | validList : #{validList} |" );
                @debug("TEMPLIST:",$tempList);
            }

        }@else if(list.length($tempList) <= 0) or not list.index($tempList,false){

            $validList: list.append($validList,true);

            @if($debug){
                @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED fullList. | | validList : #{validList} |" );
                @debug("TEMPLIST:",$tempList);
            }

        }

    }

    // If $validList contains a false then return false,
    // else return true.
    @if(list.index($validList,false)){
        
        @if($debug){
            @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, DID NOT pass constraints, returning false |" );
        }

        @return false;
        
    }@else{

        @if($debug){
            @debug("| CheckVariableConstraint_Debug | | Check: #{$check}, PASSED constraints, returning true |" );
        }

        @return true;

    }

}